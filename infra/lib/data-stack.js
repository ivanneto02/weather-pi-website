"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WeatherPIDataStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const dynamodb = __importStar(require("aws-cdk-lib/aws-dynamodb"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const apigateway = __importStar(require("aws-cdk-lib/aws-apigateway"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const events = __importStar(require("aws-cdk-lib/aws-events"));
const targets = __importStar(require("aws-cdk-lib/aws-events-targets"));
const WINDOW_SCHEDULES = [
    { window: "1h", rate: events.Schedule.rate(cdk.Duration.minutes(5)) },
    { window: "10h", rate: events.Schedule.rate(cdk.Duration.minutes(10)) },
    { window: "1d", rate: events.Schedule.rate(cdk.Duration.minutes(30)) },
    { window: "10d", rate: events.Schedule.rate(cdk.Duration.hours(2)) },
    { window: "3m", rate: events.Schedule.rate(cdk.Duration.hours(6)) },
    { window: "12m", rate: events.Schedule.rate(cdk.Duration.hours(12)) },
];
class WeatherPIDataStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // --------- PRE-COMPUTED DATA BUCKET --------------
        const precomputedBucket = new s3.Bucket(this, "WeatherPIPrecomputedDataBucket", {
            removalPolicy: cdk.RemovalPolicy.DESTROY,
            autoDeleteObjects: true,
            blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
            lifecycleRules: [{ expiration: cdk.Duration.days(30) }],
        });
        // --------- HUMIDITY, TEMPERATURE, PRESSURE --------------
        /* DynamoDB stores temperature, humidity, and pressure data entries */
        const humidityTemperaturePressureDataTable = new dynamodb.TableV2(this, "WeatherPIHumidityTemperaturePressureDataTable", {
            partitionKey: { name: "pk", type: dynamodb.AttributeType.STRING },
            sortKey: { name: "timestamp", type: dynamodb.AttributeType.STRING },
            contributorInsights: false, // prevent charges
            tableClass: dynamodb.TableClass.STANDARD,
        });
        // lambda function to batch add data entries
        const humidityTemperaturePressureUploadFunction = new lambda.Function(this, "WeatherPIHumidityTemperaturePressureUploadFunction", {
            code: lambda.Code.fromAsset("lib/functions/humidityTemperaturePressureUploadFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            environment: {
                TABLE_NAME: humidityTemperaturePressureDataTable.tableName,
            },
        });
        // lambda function to batch download data entries
        const humidityTemperaturePressureDownloadFunction = new lambda.Function(this, "WeatherPIHumidityTemperaturePressureDownloadFunction", {
            code: lambda.Code.fromAsset("lib/functions/humidityTemperaturePressureDownloadFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            timeout: cdk.Duration.seconds(15),
            environment: {
                TABLE_NAME: humidityTemperaturePressureDataTable.tableName,
                BUCKET_NAME: precomputedBucket.bucketName,
                S3_PREFIX: "htp",
            },
        });
        // allow the functions to modify DynamoDB
        humidityTemperaturePressureDataTable.grantWriteData(humidityTemperaturePressureUploadFunction);
        humidityTemperaturePressureDataTable.grantReadData(humidityTemperaturePressureDownloadFunction);
        precomputedBucket.grantRead(humidityTemperaturePressureDownloadFunction);
        // api function deploys lambda
        const humidityTemperaturePressureAPI = new apigateway.RestApi(this, "WeatherPIHumidityTemperaturePressureAPI", {
            cloudWatchRole: false
        });
        // HTP cron Lambda
        const htpCronFunction = new lambda.Function(this, "WeatherPIHtpCronFunction", {
            code: lambda.Code.fromAsset("lib/functions/htpCronFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            timeout: cdk.Duration.seconds(30),
            memorySize: 256,
            environment: {
                TABLE_NAME: humidityTemperaturePressureDataTable.tableName,
                BUCKET_NAME: precomputedBucket.bucketName,
                S3_PREFIX: "htp",
                SAMPLE_COUNT: "600",
            },
        });
        humidityTemperaturePressureDataTable.grantReadData(htpCronFunction);
        precomputedBucket.grantWrite(htpCronFunction);
        // EventBridge rules for HTP cron
        for (const { window, rate } of WINDOW_SCHEDULES) {
            const rule = new events.Rule(this, `HtpCron-${window}`, {
                schedule: rate,
            });
            rule.addTarget(new targets.LambdaFunction(htpCronFunction, {
                event: events.RuleTargetInput.fromObject({ window }),
            }));
        }
        // -------- AIR QUALITY -----------
        /* DynamoDB stores air quality data entries */
        const airQualityDataTable = new dynamodb.TableV2(this, "WeatherPIAirQualityDataTable", {
            partitionKey: { name: "pk", type: dynamodb.AttributeType.STRING },
            sortKey: { name: "timestamp", type: dynamodb.AttributeType.STRING },
            contributorInsights: false, // prevent charges
            tableClass: dynamodb.TableClass.STANDARD,
        });
        // lambda function to batch add data entries
        const airQualityUploadFunction = new lambda.Function(this, "WeatherPIAirQualityUploadFunction", {
            code: lambda.Code.fromAsset("lib/functions/airQualityUploadFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            environment: {
                TABLE_NAME: airQualityDataTable.tableName,
            },
        });
        // lambda function to batch download data entries
        const airQualityDownloadFunction = new lambda.Function(this, "WeatherPIAirQualityDownloadFunction", {
            code: lambda.Code.fromAsset("lib/functions/airQualityDownloadFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            timeout: cdk.Duration.seconds(15),
            environment: {
                BUCKET_NAME: precomputedBucket.bucketName,
                S3_PREFIX: "aq",
            },
        });
        // allow the functions to modify DynamoDB
        airQualityDataTable.grantWriteData(airQualityUploadFunction);
        airQualityDataTable.grantReadData(airQualityDownloadFunction);
        precomputedBucket.grantRead(airQualityDownloadFunction);
        // api function deploys lambda
        const airQualityAPI = new apigateway.RestApi(this, "WeatherPIAirQualityAPI", {
            cloudWatchRole: false,
        });
        // AQ cron Lambda
        const aqCronFunction = new lambda.Function(this, "WeatherPIAqCronFunction", {
            code: lambda.Code.fromAsset("lib/functions/aqCronFunction"),
            runtime: lambda.Runtime.NODEJS_LATEST,
            handler: "index.handler",
            timeout: cdk.Duration.seconds(30),
            memorySize: 256,
            environment: {
                TABLE_NAME: airQualityDataTable.tableName,
                BUCKET_NAME: precomputedBucket.bucketName,
                S3_PREFIX: "aq",
                SAMPLE_COUNT: "600",
            },
        });
        airQualityDataTable.grantReadData(aqCronFunction);
        precomputedBucket.grantWrite(aqCronFunction);
        // EventBridge rules for AQ cron
        for (const { window, rate } of WINDOW_SCHEDULES) {
            const rule = new events.Rule(this, `AqCron-${window}`, {
                schedule: rate,
            });
            rule.addTarget(new targets.LambdaFunction(aqCronFunction, {
                event: events.RuleTargetInput.fromObject({ window }),
            }));
        }
        // API Resources
        const airQualityAPIResource = airQualityAPI.root.addResource("samples");
        const humidityTemperaturePressureAPIResource = humidityTemperaturePressureAPI.root.addResource("samples");
        // to upload data
        airQualityAPIResource.addMethod("PUT", new apigateway.LambdaIntegration(airQualityUploadFunction), {
            authorizationType: apigateway.AuthorizationType.IAM,
        });
        humidityTemperaturePressureAPIResource.addMethod("PUT", new apigateway.LambdaIntegration(humidityTemperaturePressureUploadFunction), {
            authorizationType: apigateway.AuthorizationType.IAM,
        });
        // to download data
        airQualityAPIResource.addMethod("GET", new apigateway.LambdaIntegration(airQualityDownloadFunction));
        airQualityAPIResource.addCorsPreflight({
            allowOrigins: ["*"], // or ["https://ivanneto.dev"] for stricter
            allowMethods: ["GET", "OPTIONS"],
            allowHeaders: ["Content-Type"],
        });
        humidityTemperaturePressureAPIResource.addMethod("GET", new apigateway.LambdaIntegration(humidityTemperaturePressureDownloadFunction));
        humidityTemperaturePressureAPIResource.addCorsPreflight({
            allowOrigins: ["*"],
            allowMethods: ["GET", "OPTIONS"],
            allowHeaders: ["Content-Type"],
        });
        // ---------------- USER PERMISSIONS ------------------
        // IAM User for Raspberry Pi
        const raspberryPiUser = new iam.User(this, "WeatherPIUser");
        // IAM Policy for air quality API
        const airQualityAPIInvokePolicy = new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["execute-api:Invoke"],
            resources: [
                cdk.Stack.of(this).formatArn({
                    service: "execute-api",
                    resource: airQualityAPI.restApiId,
                    resourceName: `${airQualityAPI.deploymentStage.stageName}/*/samples`,
                }),
            ],
        });
        // IAM Policy for humidity, temp, pressure API
        const humidityTemperaturePressureAPIInvokePolicy = new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["execute-api:Invoke"],
            resources: [
                cdk.Stack.of(this).formatArn({
                    service: "execute-api",
                    resource: humidityTemperaturePressureAPI.restApiId,
                    resourceName: `${humidityTemperaturePressureAPI.deploymentStage.stageName}/*/samples`,
                }),
            ],
        });
        // attach user to policy
        raspberryPiUser.addToPolicy(airQualityAPIInvokePolicy);
        raspberryPiUser.addToPolicy(humidityTemperaturePressureAPIInvokePolicy);
        const weatherPIAccessKey = new iam.CfnAccessKey(this, "WeatherPIDeviceAccessKey", {
            userName: raspberryPiUser.userName,
        });
        // will output to the console
        new cdk.CfnOutput(this, "WeatherPIDeviceAccessKeyId", { value: weatherPIAccessKey.ref });
        new cdk.CfnOutput(this, "WeatherPIDevicesAccessKeySecret", { value: weatherPIAccessKey.attrSecretAccessKey });
        // ----------------- END USER PERMISSIONS ------------------------
    }
}
exports.WeatherPIDataStack = WeatherPIDataStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhdGEtc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMsbUVBQXFEO0FBQ3JELCtEQUFpRDtBQUNqRCx1RUFBeUQ7QUFDekQseURBQTJDO0FBQzNDLHVEQUF5QztBQUN6QywrREFBaUQ7QUFDakQsd0VBQTBEO0FBRzFELE1BQU0sZ0JBQWdCLEdBQUc7SUFDckIsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFHLElBQUksRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQ3RFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUN2RSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUcsSUFBSSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7SUFDdkUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQ3BFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRyxJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUNwRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFF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QUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUM7b0JBQ3pCLE9BQU8sRUFBRSxhQUFhO29CQUN0QixRQUFRLEVBQUUsOEJBQThCLENBQUMsU0FBUztvQkFDbEQsWUFBWSxFQUFFLEdBQUcsOEJBQThCLENBQUMsZUFBZSxDQUFDLFNBQVMsWUFBWTtpQkFDeEYsQ0FBQzthQUNMO1NBQ0osQ0FDSixDQUFDO1FBRUYsd0JBQXdCO1FBQ3hCLGVBQWUsQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQztRQUN2RCxlQUFlLENBQUMsV0FBVyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7UUFFeEUsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxZQUFZLENBQzNDLElBQUksRUFDSiwwQkFBMEIsRUFDMUI7WUFDSSxRQUFRLEVBQUUsZUFBZSxDQUFDLFFBQVE7U0FDckMsQ0FDSixDQUFDO1FBRUYsNkJBQTZCO1FBQzdCLElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsNEJBQTRCLEVBQUUsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN6RixJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLGlDQUFpQyxFQUFFLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztRQUM5RyxrRUFBa0U7SUFFdEUsQ0FBQztDQUNKO0FBNVJELGdEQTRSQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBkeW5hbW9kYiBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWR5bmFtb2RiXCI7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSBcImF3cy1jZGstbGliL2F3cy1sYW1iZGFcIjtcbmltcG9ydCAqIGFzIGFwaWdhdGV3YXkgZnJvbSBcImF3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5XCI7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1pYW1cIjtcbmltcG9ydCAqIGFzIHMzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtczNcIjtcbmltcG9ydCAqIGFzIGV2ZW50cyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWV2ZW50c1wiO1xuaW1wb3J0ICogYXMgdGFyZ2V0cyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWV2ZW50cy10YXJnZXRzXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcblxuY29uc3QgV0lORE9XX1NDSEVEVUxFUyA9IFtcbiAgICB7IHdpbmRvdzogXCIxaFwiLCAgcmF0ZTogZXZlbnRzLlNjaGVkdWxlLnJhdGUoY2RrLkR1cmF0aW9uLm1pbnV0ZXMoNSkpIH0sXG4gICAgeyB3aW5kb3c6IFwiMTBoXCIsIHJhdGU6IGV2ZW50cy5TY2hlZHVsZS5yYXRlKGNkay5EdXJhdGlvbi5taW51dGVzKDEwKSkgfSxcbiAgICB7IHdpbmRvdzogXCIxZFwiLCAgcmF0ZTogZXZlbnRzLlNjaGVkdWxlLnJhdGUoY2RrLkR1cmF0aW9uLm1pbnV0ZXMoMzApKSB9LFxuICAgIHsgd2luZG93OiBcIjEwZFwiLCByYXRlOiBldmVudHMuU2NoZWR1bGUucmF0ZShjZGsuRHVyYXRpb24uaG91cnMoMikpIH0sXG4gICAgeyB3aW5kb3c6IFwiM21cIiwgIHJhdGU6IGV2ZW50cy5TY2hlZHVsZS5yYXRlKGNkay5EdXJhdGlvbi5ob3Vycyg2KSkgfSxcbiAgICB7IHdpbmRvdzogXCIxMm1cIiwgcmF0ZTogZXZlbnRzLlNjaGVkdWxlLnJhdGUoY2RrLkR1cmF0aW9uLmhvdXJzKDEyKSkgfSxcbl07XG5cbmV4cG9ydCBjbGFzcyBXZWF0aGVyUElEYXRhU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xuICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzPzogY2RrLlN0YWNrUHJvcHMpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICAgICAgLy8gLS0tLS0tLS0tIFBSRS1DT01QVVRFRCBEQVRBIEJVQ0tFVCAtLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgIGNvbnN0IHByZWNvbXB1dGVkQnVja2V0ID0gbmV3IHMzLkJ1Y2tldCh0aGlzLCBcIldlYXRoZXJQSVByZWNvbXB1dGVkRGF0YUJ1Y2tldFwiLCB7XG4gICAgICAgICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5ERVNUUk9ZLFxuICAgICAgICAgICAgYXV0b0RlbGV0ZU9iamVjdHM6IHRydWUsXG4gICAgICAgICAgICBibG9ja1B1YmxpY0FjY2VzczogczMuQmxvY2tQdWJsaWNBY2Nlc3MuQkxPQ0tfQUxMLFxuICAgICAgICAgICAgbGlmZWN5Y2xlUnVsZXM6IFt7IGV4cGlyYXRpb246IGNkay5EdXJhdGlvbi5kYXlzKDMwKSB9XSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gLS0tLS0tLS0tIEhVTUlESVRZLCBURU1QRVJBVFVSRSwgUFJFU1NVUkUgLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAvKiBEeW5hbW9EQiBzdG9yZXMgdGVtcGVyYXR1cmUsIGh1bWlkaXR5LCBhbmQgcHJlc3N1cmUgZGF0YSBlbnRyaWVzICovXG4gICAgICAgIGNvbnN0IGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZURhdGFUYWJsZTogZHluYW1vZGIuVGFibGVWMiA9IG5ldyBkeW5hbW9kYi5UYWJsZVYyKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiV2VhdGhlclBJSHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRGF0YVRhYmxlXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6IFwicGtcIiwgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcbiAgICAgICAgICAgICAgICBzb3J0S2V5OiB7IG5hbWU6IFwidGltZXN0YW1wXCIsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sXG4gICAgICAgICAgICAgICAgY29udHJpYnV0b3JJbnNpZ2h0czogZmFsc2UsIC8vIHByZXZlbnQgY2hhcmdlc1xuICAgICAgICAgICAgICAgIHRhYmxlQ2xhc3M6IGR5bmFtb2RiLlRhYmxlQ2xhc3MuU1RBTkRBUkQsXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gbGFtYmRhIGZ1bmN0aW9uIHRvIGJhdGNoIGFkZCBkYXRhIGVudHJpZXNcbiAgICAgICAgY29uc3QgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlVXBsb2FkRnVuY3Rpb246IGxhbWJkYS5GdW5jdGlvbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24oXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgXCJXZWF0aGVyUElIdW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVVcGxvYWRGdW5jdGlvblwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChcImxpYi9mdW5jdGlvbnMvaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlVXBsb2FkRnVuY3Rpb25cIiksXG4gICAgICAgICAgICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTX0xBVEVTVCxcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiBcImluZGV4LmhhbmRsZXJcIixcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICBUQUJMRV9OQU1FOiBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVEYXRhVGFibGUudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gbGFtYmRhIGZ1bmN0aW9uIHRvIGJhdGNoIGRvd25sb2FkIGRhdGEgZW50cmllc1xuICAgICAgICBjb25zdCBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVEb3dubG9hZEZ1bmN0aW9uOiBsYW1iZGEuRnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiV2VhdGhlclBJSHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRG93bmxvYWRGdW5jdGlvblwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChcImxpYi9mdW5jdGlvbnMvaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRG93bmxvYWRGdW5jdGlvblwiKSxcbiAgICAgICAgICAgICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfTEFURVNULFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IGNkay5EdXJhdGlvbi5zZWNvbmRzKDE1KSxcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICBUQUJMRV9OQU1FOiBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVEYXRhVGFibGUudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICBCVUNLRVRfTkFNRTogcHJlY29tcHV0ZWRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgUzNfUFJFRklYOiBcImh0cFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gYWxsb3cgdGhlIGZ1bmN0aW9ucyB0byBtb2RpZnkgRHluYW1vREJcbiAgICAgICAgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRGF0YVRhYmxlLmdyYW50V3JpdGVEYXRhKGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZVVwbG9hZEZ1bmN0aW9uKTtcbiAgICAgICAgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRGF0YVRhYmxlLmdyYW50UmVhZERhdGEoaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRG93bmxvYWRGdW5jdGlvbik7XG4gICAgICAgIHByZWNvbXB1dGVkQnVja2V0LmdyYW50UmVhZChodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVEb3dubG9hZEZ1bmN0aW9uKTtcblxuICAgICAgICAvLyBhcGkgZnVuY3Rpb24gZGVwbG95cyBsYW1iZGFcbiAgICAgICAgY29uc3QgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlQVBJOiBhcGlnYXRld2F5LlJlc3RBcGkgPSBuZXcgYXBpZ2F0ZXdheS5SZXN0QXBpKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiV2VhdGhlclBJSHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlQVBJXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY2xvdWRXYXRjaFJvbGU6IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gSFRQIGNyb24gTGFtYmRhXG4gICAgICAgIGNvbnN0IGh0cENyb25GdW5jdGlvbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJXZWF0aGVyUElIdHBDcm9uRnVuY3Rpb25cIiwge1xuICAgICAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFwibGliL2Z1bmN0aW9ucy9odHBDcm9uRnVuY3Rpb25cIiksXG4gICAgICAgICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfTEFURVNULFxuICAgICAgICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXG4gICAgICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24uc2Vjb25kcygzMCksXG4gICAgICAgICAgICBtZW1vcnlTaXplOiAyNTYsXG4gICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgIFRBQkxFX05BTUU6IGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZURhdGFUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgQlVDS0VUX05BTUU6IHByZWNvbXB1dGVkQnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgICAgICAgUzNfUFJFRklYOiBcImh0cFwiLFxuICAgICAgICAgICAgICAgIFNBTVBMRV9DT1VOVDogXCI2MDBcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZURhdGFUYWJsZS5ncmFudFJlYWREYXRhKGh0cENyb25GdW5jdGlvbik7XG4gICAgICAgIHByZWNvbXB1dGVkQnVja2V0LmdyYW50V3JpdGUoaHRwQ3JvbkZ1bmN0aW9uKTtcblxuICAgICAgICAvLyBFdmVudEJyaWRnZSBydWxlcyBmb3IgSFRQIGNyb25cbiAgICAgICAgZm9yIChjb25zdCB7IHdpbmRvdywgcmF0ZSB9IG9mIFdJTkRPV19TQ0hFRFVMRVMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJ1bGUgPSBuZXcgZXZlbnRzLlJ1bGUodGhpcywgYEh0cENyb24tJHt3aW5kb3d9YCwge1xuICAgICAgICAgICAgICAgIHNjaGVkdWxlOiByYXRlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBydWxlLmFkZFRhcmdldChuZXcgdGFyZ2V0cy5MYW1iZGFGdW5jdGlvbihodHBDcm9uRnVuY3Rpb24sIHtcbiAgICAgICAgICAgICAgICBldmVudDogZXZlbnRzLlJ1bGVUYXJnZXRJbnB1dC5mcm9tT2JqZWN0KHsgd2luZG93IH0pLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyAtLS0tLS0tLSBBSVIgUVVBTElUWSAtLS0tLS0tLS0tLVxuXG4gICAgICAgIC8qIER5bmFtb0RCIHN0b3JlcyBhaXIgcXVhbGl0eSBkYXRhIGVudHJpZXMgKi9cbiAgICAgICAgY29uc3QgYWlyUXVhbGl0eURhdGFUYWJsZTogZHluYW1vZGIuVGFibGVWMiA9IG5ldyBkeW5hbW9kYi5UYWJsZVYyKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiV2VhdGhlclBJQWlyUXVhbGl0eURhdGFUYWJsZVwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcnRpdGlvbktleTogeyBuYW1lOiBcInBrXCIsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sXG4gICAgICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiBcInRpbWVzdGFtcFwiLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxuICAgICAgICAgICAgICAgIGNvbnRyaWJ1dG9ySW5zaWdodHM6IGZhbHNlLCAvLyBwcmV2ZW50IGNoYXJnZXNcbiAgICAgICAgICAgICAgICB0YWJsZUNsYXNzOiBkeW5hbW9kYi5UYWJsZUNsYXNzLlNUQU5EQVJELFxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIGxhbWJkYSBmdW5jdGlvbiB0byBiYXRjaCBhZGQgZGF0YSBlbnRyaWVzXG4gICAgICAgIGNvbnN0IGFpclF1YWxpdHlVcGxvYWRGdW5jdGlvbjogbGFtYmRhLkZ1bmN0aW9uID0gbmV3IGxhbWJkYS5GdW5jdGlvbihcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIldlYXRoZXJQSUFpclF1YWxpdHlVcGxvYWRGdW5jdGlvblwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChcImxpYi9mdW5jdGlvbnMvYWlyUXVhbGl0eVVwbG9hZEZ1bmN0aW9uXCIpLFxuICAgICAgICAgICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU19MQVRFU1QsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgVEFCTEVfTkFNRTogYWlyUXVhbGl0eURhdGFUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBsYW1iZGEgZnVuY3Rpb24gdG8gYmF0Y2ggZG93bmxvYWQgZGF0YSBlbnRyaWVzXG4gICAgICAgIGNvbnN0IGFpclF1YWxpdHlEb3dubG9hZEZ1bmN0aW9uOiBsYW1iZGEuRnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiV2VhdGhlclBJQWlyUXVhbGl0eURvd25sb2FkRnVuY3Rpb25cIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQoXCJsaWIvZnVuY3Rpb25zL2FpclF1YWxpdHlEb3dubG9hZEZ1bmN0aW9uXCIpLFxuICAgICAgICAgICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU19MQVRFU1QsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXG4gICAgICAgICAgICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMTUpLFxuICAgICAgICAgICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgICAgICAgICAgIEJVQ0tFVF9OQU1FOiBwcmVjb21wdXRlZEJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICAgICAgICAgICAgICBTM19QUkVGSVg6IFwiYXFcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIGFsbG93IHRoZSBmdW5jdGlvbnMgdG8gbW9kaWZ5IER5bmFtb0RCXG4gICAgICAgIGFpclF1YWxpdHlEYXRhVGFibGUuZ3JhbnRXcml0ZURhdGEoYWlyUXVhbGl0eVVwbG9hZEZ1bmN0aW9uKTtcbiAgICAgICAgYWlyUXVhbGl0eURhdGFUYWJsZS5ncmFudFJlYWREYXRhKGFpclF1YWxpdHlEb3dubG9hZEZ1bmN0aW9uKTtcbiAgICAgICAgcHJlY29tcHV0ZWRCdWNrZXQuZ3JhbnRSZWFkKGFpclF1YWxpdHlEb3dubG9hZEZ1bmN0aW9uKTtcblxuICAgICAgICAvLyBhcGkgZnVuY3Rpb24gZGVwbG95cyBsYW1iZGFcbiAgICAgICAgY29uc3QgYWlyUXVhbGl0eUFQSTogYXBpZ2F0ZXdheS5SZXN0QXBpID0gbmV3IGFwaWdhdGV3YXkuUmVzdEFwaShcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIldlYXRoZXJQSUFpclF1YWxpdHlBUElcIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjbG91ZFdhdGNoUm9sZTogZmFsc2UsXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQVEgY3JvbiBMYW1iZGFcbiAgICAgICAgY29uc3QgYXFDcm9uRnVuY3Rpb24gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwiV2VhdGhlclBJQXFDcm9uRnVuY3Rpb25cIiwge1xuICAgICAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFwibGliL2Z1bmN0aW9ucy9hcUNyb25GdW5jdGlvblwiKSxcbiAgICAgICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU19MQVRFU1QsXG4gICAgICAgICAgICBoYW5kbGVyOiBcImluZGV4LmhhbmRsZXJcIixcbiAgICAgICAgICAgIHRpbWVvdXQ6IGNkay5EdXJhdGlvbi5zZWNvbmRzKDMwKSxcbiAgICAgICAgICAgIG1lbW9yeVNpemU6IDI1NixcbiAgICAgICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgICAgICAgVEFCTEVfTkFNRTogYWlyUXVhbGl0eURhdGFUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgQlVDS0VUX05BTUU6IHByZWNvbXB1dGVkQnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgICAgICAgUzNfUFJFRklYOiBcImFxXCIsXG4gICAgICAgICAgICAgICAgU0FNUExFX0NPVU5UOiBcIjYwMFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYWlyUXVhbGl0eURhdGFUYWJsZS5ncmFudFJlYWREYXRhKGFxQ3JvbkZ1bmN0aW9uKTtcbiAgICAgICAgcHJlY29tcHV0ZWRCdWNrZXQuZ3JhbnRXcml0ZShhcUNyb25GdW5jdGlvbik7XG5cbiAgICAgICAgLy8gRXZlbnRCcmlkZ2UgcnVsZXMgZm9yIEFRIGNyb25cbiAgICAgICAgZm9yIChjb25zdCB7IHdpbmRvdywgcmF0ZSB9IG9mIFdJTkRPV19TQ0hFRFVMRVMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJ1bGUgPSBuZXcgZXZlbnRzLlJ1bGUodGhpcywgYEFxQ3Jvbi0ke3dpbmRvd31gLCB7XG4gICAgICAgICAgICAgICAgc2NoZWR1bGU6IHJhdGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJ1bGUuYWRkVGFyZ2V0KG5ldyB0YXJnZXRzLkxhbWJkYUZ1bmN0aW9uKGFxQ3JvbkZ1bmN0aW9uLCB7XG4gICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50cy5SdWxlVGFyZ2V0SW5wdXQuZnJvbU9iamVjdCh7IHdpbmRvdyB9KSxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFQSSBSZXNvdXJjZXNcbiAgICAgICAgY29uc3QgYWlyUXVhbGl0eUFQSVJlc291cmNlID0gYWlyUXVhbGl0eUFQSS5yb290LmFkZFJlc291cmNlKFwic2FtcGxlc1wiKTtcbiAgICAgICAgY29uc3QgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlQVBJUmVzb3VyY2UgPSBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVBUEkucm9vdC5hZGRSZXNvdXJjZShcInNhbXBsZXNcIik7XG5cbiAgICAgICAgLy8gdG8gdXBsb2FkIGRhdGFcbiAgICAgICAgYWlyUXVhbGl0eUFQSVJlc291cmNlLmFkZE1ldGhvZChcbiAgICAgICAgICAgIFwiUFVUXCIsXG4gICAgICAgICAgICBuZXcgYXBpZ2F0ZXdheS5MYW1iZGFJbnRlZ3JhdGlvbihhaXJRdWFsaXR5VXBsb2FkRnVuY3Rpb24pLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcGlnYXRld2F5LkF1dGhvcml6YXRpb25UeXBlLklBTSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlQVBJUmVzb3VyY2UuYWRkTWV0aG9kKFxuICAgICAgICAgICAgXCJQVVRcIixcbiAgICAgICAgICAgIG5ldyBhcGlnYXRld2F5LkxhbWJkYUludGVncmF0aW9uKGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZVVwbG9hZEZ1bmN0aW9uKSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhdXRob3JpemF0aW9uVHlwZTogYXBpZ2F0ZXdheS5BdXRob3JpemF0aW9uVHlwZS5JQU0sXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gdG8gZG93bmxvYWQgZGF0YVxuICAgICAgICBhaXJRdWFsaXR5QVBJUmVzb3VyY2UuYWRkTWV0aG9kKFxuICAgICAgICAgICAgXCJHRVRcIixcbiAgICAgICAgICAgIG5ldyBhcGlnYXRld2F5LkxhbWJkYUludGVncmF0aW9uKGFpclF1YWxpdHlEb3dubG9hZEZ1bmN0aW9uKSxcbiAgICAgICAgKTtcbiAgICAgICAgYWlyUXVhbGl0eUFQSVJlc291cmNlLmFkZENvcnNQcmVmbGlnaHQoe1xuICAgICAgICAgICAgYWxsb3dPcmlnaW5zOiBbXCIqXCJdLCAvLyBvciBbXCJodHRwczovL2l2YW5uZXRvLmRldlwiXSBmb3Igc3RyaWN0ZXJcbiAgICAgICAgICAgIGFsbG93TWV0aG9kczogW1wiR0VUXCIsIFwiT1BUSU9OU1wiXSxcbiAgICAgICAgICAgIGFsbG93SGVhZGVyczogW1wiQ29udGVudC1UeXBlXCJdLFxuICAgICAgICB9KTtcblxuICAgICAgICBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVBUElSZXNvdXJjZS5hZGRNZXRob2QoXG4gICAgICAgICAgICBcIkdFVFwiLFxuICAgICAgICAgICAgbmV3IGFwaWdhdGV3YXkuTGFtYmRhSW50ZWdyYXRpb24oaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlRG93bmxvYWRGdW5jdGlvbiksXG4gICAgICAgICk7XG4gICAgICAgIGh1bWlkaXR5VGVtcGVyYXR1cmVQcmVzc3VyZUFQSVJlc291cmNlLmFkZENvcnNQcmVmbGlnaHQoe1xuICAgICAgICAgICAgYWxsb3dPcmlnaW5zOiBbXCIqXCJdLFxuICAgICAgICAgICAgYWxsb3dNZXRob2RzOiBbXCJHRVRcIiwgXCJPUFRJT05TXCJdLFxuICAgICAgICAgICAgYWxsb3dIZWFkZXJzOiBbXCJDb250ZW50LVR5cGVcIl0sXG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLSBVU0VSIFBFUk1JU1NJT05TIC0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvLyBJQU0gVXNlciBmb3IgUmFzcGJlcnJ5IFBpXG4gICAgICAgIGNvbnN0IHJhc3BiZXJyeVBpVXNlciA9IG5ldyBpYW0uVXNlcihcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIldlYXRoZXJQSVVzZXJcIixcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBJQU0gUG9saWN5IGZvciBhaXIgcXVhbGl0eSBBUElcbiAgICAgICAgY29uc3QgYWlyUXVhbGl0eUFQSUludm9rZVBvbGljeSA9IG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgICAgICAgICBhY3Rpb25zOiBbXCJleGVjdXRlLWFwaTpJbnZva2VcIl0sXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZTogXCJleGVjdXRlLWFwaVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IGFpclF1YWxpdHlBUEkucmVzdEFwaUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiBgJHthaXJRdWFsaXR5QVBJLmRlcGxveW1lbnRTdGFnZS5zdGFnZU5hbWV9Lyovc2FtcGxlc2AsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gSUFNIFBvbGljeSBmb3IgaHVtaWRpdHksIHRlbXAsIHByZXNzdXJlIEFQSVxuICAgICAgICBjb25zdCBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVBUElJbnZva2VQb2xpY3kgPSBuZXcgaWFtLlBvbGljeVN0YXRlbWVudChcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1wiZXhlY3V0ZS1hcGk6SW52b2tlXCJdLFxuICAgICAgICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgICAgICAgICBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2U6IFwiZXhlY3V0ZS1hcGlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlOiBodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVBUEkucmVzdEFwaUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiBgJHtodW1pZGl0eVRlbXBlcmF0dXJlUHJlc3N1cmVBUEkuZGVwbG95bWVudFN0YWdlLnN0YWdlTmFtZX0vKi9zYW1wbGVzYCxcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBhdHRhY2ggdXNlciB0byBwb2xpY3lcbiAgICAgICAgcmFzcGJlcnJ5UGlVc2VyLmFkZFRvUG9saWN5KGFpclF1YWxpdHlBUElJbnZva2VQb2xpY3kpO1xuICAgICAgICByYXNwYmVycnlQaVVzZXIuYWRkVG9Qb2xpY3koaHVtaWRpdHlUZW1wZXJhdHVyZVByZXNzdXJlQVBJSW52b2tlUG9saWN5KTtcblxuICAgICAgICBjb25zdCB3ZWF0aGVyUElBY2Nlc3NLZXkgPSBuZXcgaWFtLkNmbkFjY2Vzc0tleShcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIldlYXRoZXJQSURldmljZUFjY2Vzc0tleVwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiByYXNwYmVycnlQaVVzZXIudXNlck5hbWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIHdpbGwgb3V0cHV0IHRvIHRoZSBjb25zb2xlXG4gICAgICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsIFwiV2VhdGhlclBJRGV2aWNlQWNjZXNzS2V5SWRcIiwgeyB2YWx1ZTogd2VhdGhlclBJQWNjZXNzS2V5LnJlZiB9KTtcbiAgICAgICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgXCJXZWF0aGVyUElEZXZpY2VzQWNjZXNzS2V5U2VjcmV0XCIsIHsgdmFsdWU6IHdlYXRoZXJQSUFjY2Vzc0tleS5hdHRyU2VjcmV0QWNjZXNzS2V5IH0pO1xuICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLSBFTkQgVVNFUiBQRVJNSVNTSU9OUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIH1cbn1cbiJdfQ==